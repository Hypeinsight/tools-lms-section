<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tools with Interactive Annotations</title>
  <style>
    :root {
      --primary-blue: #1482FF;
      --tooltip-blue: #E3F2FD;
      --tooltip-border: #2196F3;
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
      background: #f3f4f6;
      padding: 20px;
      overflow-x: hidden;
    }
    
    .demo-container {
      max-width: 1440px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    
    .header {
      background: var(--primary-blue);
      color: white;
      padding: 20px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .header h1 {
      font-size: 24px;
      font-weight: 600;
    }
    
    .header-controls {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .status-indicator {
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(255, 255, 255, 0.15);
      padding: 8px 15px;
      border-radius: 6px;
      font-size: 14px;
    }
    
    .btn {
      padding: 8px 16px;
      border: 2px solid white;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .btn:hover {
      background: white;
      color: var(--primary-blue);
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #10b981;
      animation: pulse 2s infinite;
    }
    
    .iframe-wrapper {
      position: relative;
      width: 100%;
      height: calc(100vh - 120px); /* Full height minus header and padding */
      min-height: 600px;
      background: #DAE5F1;
    }
    
    .tools-iframe {
      width: 100%;
      height: 100%;
      border: none;
      display: block;
    }
    
    /* Interaction capture overlay */
    .interaction-capture {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 5;
      pointer-events: auto;
      background: transparent;
    }
    
    .interaction-capture.removed {
      display: none;
    }
    
    /* Annotations overlay */
    .annotations-layer {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
      z-index: 10;
      transition: opacity 0.3s ease;
    }
    
    .annotations-layer.hidden {
      opacity: 0;
    }
    
    /* Blue tooltip style from image */
    .tooltip-bubble {
      position: absolute;
      background: var(--tooltip-blue);
      border: 2px solid var(--tooltip-border);
      border-radius: 8px;
      padding: 8px 15px;
      font-size: 13px;
      font-weight: 600;
      color: #1565C0;
      pointer-events: auto;
      box-shadow: 0 2px 8px rgba(33, 150, 243, 0.3);
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: all 0.2s;
      z-index: 50; /* Above capture overlay */
    }
    
    .tooltip-bubble:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
    }
    
    .tooltip-bubble::before {
      content: '‚ÑπÔ∏è';
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
      background: white;
      border-radius: 50%;
      border: 1px solid var(--tooltip-border);
    }
    
    /* Expanded tooltip detail */
    .tooltip-detail {
      position: absolute;
      background: white;
      border: 2px solid var(--tooltip-border);
      border-radius: 8px;
      padding: 15px 18px;
      font-size: 14px;
      line-height: 1.6;
      color: #1F2937;
      max-width: 300px;
      pointer-events: auto;
      z-index: 100; /* Above everything */
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
      display: none;
    }
    
    .tooltip-detail.visible {
      display: block;
      animation: fadeInUp 0.3s ease-out;
    }
    
    .tooltip-detail::before {
      content: '';
      position: absolute;
      bottom: 100%;
      left: 20px;
      width: 0;
      height: 0;
      border-style: solid;
      border-width: 0 8px 8px 8px;
      border-color: transparent transparent var(--tooltip-border) transparent;
    }
    
    .tooltip-detail strong {
      color: var(--primary-blue);
    }
    
    
    /* Status banner */
    .status-banner {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(16, 185, 129, 0.95);
      color: white;
      padding: 10px 20px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 500;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 50;
      pointer-events: none;
      transition: all 0.3s;
    }
    
    .status-banner.warning {
      background: rgba(245, 158, 11, 0.95);
    }
    
    /* Animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.5;
      }
    }
  </style>
</head>
<body>
  <div class="demo-container">
    <div class="header">
      <h1>üéì Building Tools‚Ñ¢ Interactive Guide</h1>
      <div class="header-controls">
        <button class="btn" id="toggleAnnotations">üëÅÔ∏è Hide Annotations</button>
        <button class="btn" id="resetBtn">üîÑ Reset to Default</button>
        <div class="status-indicator">
          <div class="status-dot"></div>
          <span id="statusText">Annotations visible</span>
        </div>
      </div>
    </div>
    
    <div class="iframe-wrapper">
      <iframe 
        id="toolsIframe"
        class="tools-iframe"
        src="https://app.buildingtools.co/tools/access-stairs-private-handrails-balustrades-ncc2022.2-1.22?v=1&block=f395f28c-dfab-4a9b-9c0d-dc724a0b032b&standard=NCC%202022.2&standard=&menu_id=0-8-1&shareId=FmGcYD-1765161617156&zoom=2.2898&x=570.1130417311147&y=238.7100387198926&action=click&type=0&chromeless=true"
        allowfullscreen>
      </iframe>
      
      <!-- Interaction capture overlay -->
      <div class="interaction-capture" id="interactionCapture"></div>
      
      <!-- Annotations overlay -->
      <div class="annotations-layer" id="annotationsLayer">
        <!-- Blue tooltip bubbles (like in the image) -->
        <div class="tooltip-bubble" style="top: 5%; left: 10%;" data-tooltip="ai-search">
          AI Search
        </div>
        <div class="tooltip-detail" id="ai-search" style="top: 8%; left: 10%;">
          Use <strong>AI Search</strong> to find building code content using natural language queries. Just describe what you're looking for!
        </div>
        
        <div class="tooltip-bubble" style="top: 5%; left: 40%;" data-tooltip="text-search">
          Text Search
        </div>
        <div class="tooltip-detail" id="text-search" style="top: 8%; left: 40%;">
          <strong>Text Search</strong> lets you search for specific terms, codes, or keywords within the building standards.
        </div>
        
        <div class="tooltip-bubble" style="top: 25%; left: 15%;" data-tooltip="hotspot">
          Hotspot to information
        </div>
        <div class="tooltip-detail" id="hotspot" style="top: 28%; left: 15%;">
          Click on <strong>red hotspot indicators</strong> throughout the diagram to reveal detailed requirements and specifications.
        </div>
        
        <div class="tooltip-bubble" style="top: 20%; left: 85%;" data-tooltip="account">
          Account
        </div>
        <div class="tooltip-detail" id="account" style="top: 23%; left: 70%;">
          Access your <strong>Account</strong> settings, saved projects, and personalized learning progress.
        </div>
        
        <div class="tooltip-bubble" style="top: 45%; left: 42%;" data-tooltip="graphic">
          Graphic Symbol
        </div>
        <div class="tooltip-detail" id="graphic" style="top: 48%; left: 42%;">
          <strong>Graphic Symbols</strong> are interactive visual elements that explain building code requirements through diagrams.
        </div>
        
        <div class="tooltip-bubble" style="top: 50%; left: 68%;" data-tooltip="code-value">
          Code Value
        </div>
        <div class="tooltip-detail" id="code-value" style="top: 53%; left: 68%;">
          View the actual <strong>Code Values</strong> and numerical requirements specified in the building standards.
        </div>
        
        <div class="tooltip-bubble" style="top: 65%; left: 55%;" data-tooltip="citation">
          Citation
        </div>
        <div class="tooltip-detail" id="citation" style="top: 68%; left: 55%;">
          <strong>Citations</strong> link directly to the relevant sections in the official building code documentation.
        </div>
        
      </div>
      
      <!-- Status banner -->
      <div class="status-banner" id="statusBanner">
        üí° Annotations shown at default view - Zoom/pan to explore
      </div>
    </div>
  </div>
  
  <script>
    const iframe = document.getElementById('toolsIframe');
    const annotationsLayer = document.getElementById('annotationsLayer');
    const statusBanner = document.getElementById('statusBanner');
    const statusText = document.getElementById('statusText');
    const resetBtn = document.getElementById('resetBtn');
    const toggleBtn = document.getElementById('toggleAnnotations');
    const interactionCapture = document.getElementById('interactionCapture');
    
    const originalSrc = iframe.src;
    let annotationsVisible = true;
    let captureActive = true;
    
    // Hide annotations and remove capture overlay
    function hideAnnotationsOnInteraction() {
      if (annotationsVisible) {
        annotationsVisible = false;
        annotationsLayer.classList.add('hidden');
        toggleBtn.textContent = 'üëÅÔ∏è Show Annotations';
        statusText.textContent = 'Annotations hidden';
        
        // Remove capture overlay so user can interact with iframe
        captureActive = false;
        interactionCapture.classList.add('removed');
        
        // Show banner
        statusBanner.textContent = 'üîç Annotations hidden - Click "Reset" to restore';
        statusBanner.className = 'status-banner warning';
        statusBanner.style.opacity = '1';
        statusBanner.style.display = 'block';
      }
    }
    
    // Capture any interaction on the overlay
    interactionCapture.addEventListener('mousedown', (e) => {
      // Let clicks on tooltips pass through without hiding
      const clickedElement = document.elementFromPoint(e.clientX, e.clientY);
      const isTooltipClick = clickedElement && (
        clickedElement.classList.contains('tooltip-bubble') ||
        clickedElement.classList.contains('tooltip-detail') ||
        clickedElement.closest('.tooltip-bubble') ||
        clickedElement.closest('.tooltip-detail')
      );
      
      if (!isTooltipClick) {
        hideAnnotationsOnInteraction();
        // Immediately remove overlay after detection so click can pass through
        setTimeout(() => {
          if (!captureActive) {
            // Simulate click on iframe after a tiny delay
            const rect = iframe.getBoundingClientRect();
            const clickEvent = new MouseEvent('mousedown', {
              clientX: e.clientX,
              clientY: e.clientY,
              bubbles: true
            });
            iframe.dispatchEvent(clickEvent);
          }
        }, 10);
      }
    });
    
    interactionCapture.addEventListener('wheel', (e) => {
      e.preventDefault(); // Prevent page zoom
      hideAnnotationsOnInteraction();
      // After hiding, the overlay is removed and iframe can receive future wheel events
    }, { passive: false }); // Must be non-passive to preventDefault
    
    interactionCapture.addEventListener('touchstart', (e) => {
      const touchedElement = document.elementFromPoint(e.touches[0].clientX, e.touches[0].clientY);
      const isTooltipTouch = touchedElement && (
        touchedElement.classList.contains('tooltip-bubble') ||
        touchedElement.classList.contains('tooltip-detail') ||
        touchedElement.closest('.tooltip-bubble') ||
        touchedElement.closest('.tooltip-detail')
      );
      
      if (!isTooltipTouch) {
        hideAnnotationsOnInteraction();
      }
    }, { passive: true });
    
    // Toggle annotations visibility
    toggleBtn.addEventListener('click', () => {
      annotationsVisible = !annotationsVisible;
      
      if (annotationsVisible) {
        // Show annotations and restore capture
        annotationsLayer.classList.remove('hidden');
        toggleBtn.textContent = 'üëÅÔ∏è Hide Annotations';
        statusText.textContent = 'Annotations visible';
        captureActive = true;
        interactionCapture.classList.remove('removed');
      } else {
        // Hide annotations
        annotationsLayer.classList.add('hidden');
        toggleBtn.textContent = 'üëÅÔ∏è Show Annotations';
        statusText.textContent = 'Annotations hidden';
        captureActive = false;
        interactionCapture.classList.add('removed');
      }
    });
    
    // Reset button functionality
    resetBtn.addEventListener('click', () => {
      // Reload iframe to default view
      iframe.src = originalSrc;
      
      // Show annotations and restore capture
      annotationsVisible = true;
      captureActive = true;
      annotationsLayer.classList.remove('hidden');
      interactionCapture.classList.remove('removed');
      toggleBtn.textContent = 'üëÅÔ∏è Hide Annotations';
      statusText.textContent = 'Annotations visible';
      statusBanner.textContent = '‚úÖ Reset to default view - Annotations visible';
      statusBanner.className = 'status-banner';
      statusBanner.style.opacity = '1';
      statusBanner.style.display = 'block';
      
      // Hide banner after 3 seconds
      setTimeout(() => {
        statusBanner.style.opacity = '0';
        setTimeout(() => {
          statusBanner.style.display = 'none';
        }, 300);
      }, 3000);
    });
    
    // Tooltip interactions - stop all events from propagating
    const tooltipBubbles = document.querySelectorAll('.tooltip-bubble');
    
    tooltipBubbles.forEach(bubble => {
      // Stop mousedown from reaching capture overlay
      bubble.addEventListener('mousedown', (e) => {
        e.stopPropagation();
      }, true);
      
      bubble.addEventListener('click', (e) => {
        e.stopPropagation();
        const tooltipId = bubble.getAttribute('data-tooltip');
        const tooltip = document.getElementById(tooltipId);
        
        // Hide all other tooltips
        document.querySelectorAll('.tooltip-detail').forEach(t => {
          if (t.id !== tooltipId) {
            t.classList.remove('visible');
          }
        });
        
        // Toggle current tooltip
        tooltip.classList.toggle('visible');
      });
    });
    
    // Also stop events on tooltip details
    const tooltipDetails = document.querySelectorAll('.tooltip-detail');
    tooltipDetails.forEach(detail => {
      detail.addEventListener('mousedown', (e) => {
        e.stopPropagation();
      }, true);
    });
    
    // Close tooltips when clicking outside
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.tooltip-bubble') && !e.target.closest('.tooltip-detail')) {
        document.querySelectorAll('.tooltip-detail').forEach(t => t.classList.remove('visible'));
      }
    });
    
    // Hide status banner after 5 seconds
    setTimeout(() => {
      statusBanner.style.opacity = '0';
      setTimeout(() => {
        statusBanner.style.display = 'none';
      }, 300);
    }, 5000);
  </script>
</body>
</html>
