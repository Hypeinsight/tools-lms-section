<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tools Annotations - Smart Mode</title>
  <style>
    :root {
      --primary-blue: #1482FF;
      --tooltip-bg: #1F2937;
      --callout-bg: rgba(255, 255, 255, 0.95);
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
      background: #f3f4f6;
      padding: 20px;
    }
    
    .demo-container {
      max-width: 1440px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    
    .header {
      background: var(--primary-blue);
      color: white;
      padding: 20px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .header h1 {
      font-size: 24px;
      font-weight: 600;
    }
    
    .controls {
      display: flex;
      gap: 15px;
      align-items: center;
    }
    
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .btn-primary {
      background: white;
      color: var(--primary-blue);
    }
    
    .btn-primary:hover {
      background: #f0f0f0;
    }
    
    .btn-secondary {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: 1px solid white;
    }
    
    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    
    .mode-switch {
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(255, 255, 255, 0.15);
      padding: 8px 15px;
      border-radius: 6px;
    }
    
    .mode-switch label {
      font-size: 14px;
      cursor: pointer;
    }
    
    .toggle-switch {
      position: relative;
      width: 50px;
      height: 24px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .toggle-switch::after {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      transition: all 0.3s;
    }
    
    .toggle-switch.active {
      background: #10b981;
    }
    
    .toggle-switch.active::after {
      left: 28px;
    }
    
    .iframe-wrapper {
      position: relative;
      width: 100%;
      height: 800px;
      background: #DAE5F1;
    }
    
    .tools-iframe {
      width: 100%;
      height: 100%;
      border: none;
      display: block;
    }
    
    /* Interaction blocker - captures mouse events */
    .interaction-detector {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 5;
      pointer-events: auto;
      cursor: pointer;
    }
    
    /* Overlay system */
    .annotations-layer {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
      z-index: 10;
      transition: opacity 0.5s;
    }
    
    .annotations-layer.hidden {
      opacity: 0;
    }
    
    .annotations-layer.interacting {
      opacity: 0.3;
    }
    
    /* Callout boxes */
    .callout {
      position: absolute;
      background: var(--callout-bg);
      border: 2px solid var(--primary-blue);
      border-radius: 12px;
      padding: 15px 20px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      pointer-events: auto;
      animation: fadeInScale 0.4s ease-out;
      max-width: 280px;
    }
    
    .callout-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--primary-blue);
      margin-bottom: 8px;
    }
    
    .callout-text {
      font-size: 14px;
      line-height: 1.5;
      color: #4B5563;
    }
    
    .callout::after {
      content: '';
      position: absolute;
      width: 0;
      height: 0;
      border-style: solid;
    }
    
    .callout.arrow-left::after {
      right: 100%;
      top: 50%;
      transform: translateY(-50%);
      border-width: 10px 10px 10px 0;
      border-color: transparent var(--primary-blue) transparent transparent;
    }
    
    .callout.arrow-top::after {
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      border-width: 0 10px 10px 10px;
      border-color: transparent transparent var(--primary-blue) transparent;
    }
    
    .callout.arrow-bottom::after {
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border-width: 10px 10px 0 10px;
      border-color: var(--primary-blue) transparent transparent transparent;
    }
    
    /* Info tooltips */
    .info-icon {
      position: absolute;
      width: 32px;
      height: 32px;
      background: var(--primary-blue);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 18px;
      cursor: pointer;
      pointer-events: auto;
      transition: all 0.3s;
      animation: pulse 2s infinite;
      box-shadow: 0 2px 8px rgba(20, 130, 255, 0.4);
    }
    
    .info-icon:hover {
      transform: scale(1.15);
      box-shadow: 0 4px 16px rgba(20, 130, 255, 0.6);
    }
    
    .info-icon.active {
      background: #0d6efd;
      animation: none;
    }
    
    .tooltip {
      position: absolute;
      background: var(--tooltip-bg);
      color: white;
      padding: 15px 18px;
      border-radius: 8px;
      font-size: 14px;
      line-height: 1.6;
      max-width: 300px;
      pointer-events: auto;
      z-index: 100;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
      display: none;
    }
    
    .tooltip.visible {
      display: block;
      animation: fadeInUp 0.3s ease-out;
    }
    
    .tooltip::before {
      content: '';
      position: absolute;
      bottom: 100%;
      left: 20px;
      width: 0;
      height: 0;
      border-style: solid;
      border-width: 0 8px 8px 8px;
      border-color: transparent transparent var(--tooltip-bg) transparent;
    }
    
    /* Highlight areas */
    .highlight-area {
      position: absolute;
      border: 3px dashed var(--primary-blue);
      border-radius: 8px;
      background: rgba(20, 130, 255, 0.1);
      pointer-events: none;
    }
    
    /* Status messages */
    .status-banner {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(16, 185, 129, 0.95);
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 50;
      pointer-events: none;
      transition: all 0.3s;
    }
    
    .status-banner.warning {
      background: rgba(245, 158, 11, 0.95);
    }
    
    .status-banner.info {
      background: rgba(59, 130, 246, 0.95);
    }
    
    .reset-prompt {
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(239, 68, 68, 0.95);
      color: white;
      padding: 15px 25px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      z-index: 50;
      pointer-events: auto;
      display: none;
      animation: slideUp 0.3s ease-out;
    }
    
    .reset-prompt.visible {
      display: block;
    }
    
    .reset-prompt button {
      margin-left: 15px;
      padding: 6px 15px;
      border: 2px solid white;
      background: transparent;
      color: white;
      border-radius: 4px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .reset-prompt button:hover {
      background: white;
      color: #EF4444;
    }
    
    /* Animations */
    @keyframes fadeInScale {
      from {
        opacity: 0;
        transform: scale(0.9);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.1);
      }
    }
    
    @keyframes slideUp {
      from {
        transform: translateX(-50%) translateY(20px);
        opacity: 0;
      }
      to {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
      }
    }
  </style>
</head>
<body>
  <div class="demo-container">
    <div class="header">
      <h1>ðŸŽ“ Smart Annotations Demo</h1>
      <div class="controls">
        <div class="mode-switch">
          <label>Locked Mode</label>
          <div class="toggle-switch" id="modeToggle"></div>
        </div>
        <button class="btn btn-primary" id="resetView">Reset View</button>
      </div>
    </div>
    
    <div class="iframe-wrapper">
      <iframe 
        id="toolsIframe"
        class="tools-iframe"
        src="https://app.buildingtools.co/tools/access-stairs-private-handrails-balustrades-ncc2022.2-1.22?v=1&block=f395f28c-dfab-4a9b-9c0d-dc724a0b032b&standard=NCC%202022.2&standard=&menu_id=0-8-1&shareId=FmGcYD-1765161617156&zoom=2.2898&x=570.1130417311147&y=238.7100387198926&action=click&type=0&chromeless=true"
        allowfullscreen>
      </iframe>
      
      <!-- Interaction detector layer -->
      <div class="interaction-detector" id="interactionDetector"></div>
      
      <!-- Annotations overlay (hidden by default in locked mode) -->
      <div class="annotations-layer hidden" id="annotationsLayer">
        <!-- Info icons -->
        <div class="info-icon" style="top: 8%; left: 12%;" data-tooltip="search-tooltip">
          <span>i</span>
        </div>
        <div class="tooltip" id="search-tooltip" style="top: 11%; left: 12%;">
          Use <strong>AI Search</strong> or <strong>Text Search</strong> to find building code content.
        </div>
        
        <div class="info-icon" style="top: 35%; left: 20%;" data-tooltip="hotspot-tooltip">
          <span>i</span>
        </div>
        <div class="tooltip" id="hotspot-tooltip" style="top: 38%; left: 20%;">
          Click <strong>red hotspot indicators</strong> to reveal detailed code requirements.
        </div>
        
        <div class="info-icon" style="top: 50%; left: 40%;" data-tooltip="graphic-tooltip">
          <span>i</span>
        </div>
        <div class="tooltip" id="graphic-tooltip" style="top: 53%; left: 40%;">
          Interactive <strong>Graphic Symbols</strong> explain requirements visually.
        </div>
        
        <div class="info-icon" style="top: 55%; left: 65%;" data-tooltip="code-tooltip">
          <span>i</span>
        </div>
        <div class="tooltip" id="code-tooltip" style="top: 58%; left: 65%;">
          View actual <strong>Code Values</strong> alongside visual representations.
        </div>
        
        <!-- Callouts -->
        <div class="callout arrow-left" style="top: 8%; right: 5%;">
          <div class="callout-title">Visual Search</div>
          <div class="callout-text">Navigate codes using interactive diagrams</div>
        </div>
        
        <div class="callout arrow-bottom" style="bottom: 20%; left: 8%;">
          <div class="callout-title">Zoom Controls</div>
          <div class="callout-text">Focus on specific requirement details</div>
        </div>
        
        <div class="callout arrow-top" style="top: 3%; left: 35%;">
          <div class="callout-title">Search Options</div>
          <div class="callout-text">AI-powered or text-based search</div>
        </div>
        
        <!-- Highlights -->
        <div class="highlight-area" style="top: 28%; left: 12%; width: 28%; height: 40%;"></div>
        <div class="highlight-area" style="top: 45%; left: 55%; width: 22%; height: 28%;"></div>
      </div>
      
      <!-- Status banner -->
      <div class="status-banner" id="statusBanner">
        ðŸ”’ Locked View - Default state restored
      </div>
    </div>
  </div>
  
  <script>
    const iframe = document.getElementById('toolsIframe');
    const interactionDetector = document.getElementById('interactionDetector');
    const annotationsLayer = document.getElementById('annotationsLayer');
    const modeToggle = document.getElementById('modeToggle');
    const statusBanner = document.getElementById('statusBanner');
    const resetBtn = document.getElementById('resetView');
    
    let isLockedMode = true; // Start in locked mode
    let interactionTimeout;
    
    const originalSrc = iframe.src;
    
    // Toggle between locked and free mode
    modeToggle.addEventListener('click', () => {
      isLockedMode = !isLockedMode;
      modeToggle.classList.toggle('active');
      
      if (isLockedMode) {
        // Locked: Hide annotations, restore default view, block iframe interaction
        resetView();
        annotationsLayer.classList.add('hidden');
        interactionDetector.style.display = 'block';
        statusBanner.textContent = 'ðŸ”’ Locked View - Default state restored';
        statusBanner.className = 'status-banner';
      } else {
        // Free: Show annotations, remove detector to allow iframe interaction
        annotationsLayer.classList.remove('hidden');
        interactionDetector.style.display = 'none';
        statusBanner.textContent = 'ðŸ”“ Free Mode - Annotations visible, interact to auto-lock';
        statusBanner.className = 'status-banner warning';
        
        // Start monitoring for iframe changes
        startMonitoringIframe();
      }
    });
    
    // Detect when user tries to interact with iframe in locked mode
    interactionDetector.addEventListener('mousedown', (e) => {
      e.preventDefault();
      e.stopPropagation();
      
      // Show brief message
      statusBanner.textContent = 'ðŸ’¡ Switch to Free Mode to interact with the diagram';
      statusBanner.className = 'status-banner info';
      
      clearTimeout(interactionTimeout);
      interactionTimeout = setTimeout(() => {
        statusBanner.textContent = 'ðŸ”’ Locked View - Default state restored';
        statusBanner.className = 'status-banner';
      }, 2000);
    });
    
    // Detect wheel events (zoom attempts) in locked mode
    interactionDetector.addEventListener('wheel', (e) => {
      e.preventDefault();
      e.stopPropagation();
    });
    
    // Helper function to auto-lock and reset
    function autoLockAndReset(reason) {
      stopMonitoringIframe();
      
      isLockedMode = true;
      modeToggle.classList.remove('active');
      annotationsLayer.classList.add('hidden');
      interactionDetector.style.display = 'block';
      
      statusBanner.textContent = `ðŸ”’ View locked - ${reason}, restored to default`;
      statusBanner.className = 'status-banner';
      
      // Reset iframe
      resetView();
      
      // Reset status message after 3 seconds
      clearTimeout(interactionTimeout);
      interactionTimeout = setTimeout(() => {
        statusBanner.textContent = 'ðŸ”’ Locked View - Default state restored';
      }, 3000);
    }
    
    // Monitor iframe for interaction in free mode
    let monitoringInterval;
    let lastIframeSrc = originalSrc;
    let lockTimeout;
    let isLocking = false;
    
    function startMonitoringIframe() {
      lastIframeSrc = iframe.src;
      isLocking = false;
      
      monitoringInterval = setInterval(() => {
        // Check if iframe URL changed (indicates zoom/pan)
        if (iframe.src !== lastIframeSrc && !isLocking) {
          triggerAutoLock('View changed');
        }
      }, 200);
      
      // Also listen for any mouse activity on the window
      window.addEventListener('mousedown', handleFreeInteraction, true);
      window.addEventListener('wheel', handleFreeInteraction, { passive: true, capture: true });
    }
    
    function stopMonitoringIframe() {
      if (monitoringInterval) {
        clearInterval(monitoringInterval);
        monitoringInterval = null;
      }
      if (lockTimeout) {
        clearTimeout(lockTimeout);
        lockTimeout = null;
      }
      window.removeEventListener('mousedown', handleFreeInteraction, true);
      window.removeEventListener('wheel', handleFreeInteraction, true);
    }
    
    function handleFreeInteraction(e) {
      // Only trigger if interaction is on/near the iframe
      const iframeRect = iframe.getBoundingClientRect();
      if (e.clientX >= iframeRect.left && e.clientX <= iframeRect.right &&
          e.clientY >= iframeRect.top && e.clientY <= iframeRect.bottom) {
        triggerAutoLock('Interaction detected');
      }
    }
    
    function triggerAutoLock(reason) {
      if (isLocking) return; // Prevent multiple triggers
      
      // Clear any existing timeout
      if (lockTimeout) {
        clearTimeout(lockTimeout);
      }
      
      // Set new timeout
      lockTimeout = setTimeout(() => {
        if (!isLockedMode && !isLocking) {
          isLocking = true;
          autoLockAndReset(reason);
        }
      }, 1500); // Give user 1.5 seconds to complete their action
    }
    
    
    // Reset view to default
    function resetView() {
      iframe.src = originalSrc;
    }
    
    resetBtn.addEventListener('click', () => {
      // Reset always goes to locked mode
      stopMonitoringIframe();
      
      if (!isLockedMode) {
        isLockedMode = true;
        modeToggle.classList.remove('active');
        interactionDetector.style.display = 'block';
        annotationsLayer.classList.add('hidden');
      }
      resetView();
      statusBanner.textContent = 'ðŸ”’ Locked View - Default state restored';
      statusBanner.className = 'status-banner';
    });
    
    // Info icon tooltip interactions
    const infoIcons = document.querySelectorAll('.info-icon');
    
    infoIcons.forEach(icon => {
      icon.addEventListener('click', (e) => {
        e.stopPropagation();
        const tooltipId = icon.getAttribute('data-tooltip');
        const tooltip = document.getElementById(tooltipId);
        
        // Hide all other tooltips
        document.querySelectorAll('.tooltip').forEach(t => {
          if (t.id !== tooltipId) {
            t.classList.remove('visible');
          }
        });
        
        // Remove active state from all icons
        document.querySelectorAll('.info-icon').forEach(i => {
          if (i !== icon) {
            i.classList.remove('active');
          }
        });
        
        // Toggle current tooltip
        tooltip.classList.toggle('visible');
        icon.classList.toggle('active');
      });
    });
    
    // Close tooltips when clicking outside
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.info-icon') && !e.target.closest('.tooltip')) {
        document.querySelectorAll('.tooltip').forEach(t => t.classList.remove('visible'));
        document.querySelectorAll('.info-icon').forEach(i => i.classList.remove('active'));
      }
    });
  </script>
</body>
</html>
